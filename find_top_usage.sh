#!/bin/bash

# ==============================================================================
# è…³æœ¬åç¨±: find_top_usage.sh
# åŠŸ    èƒ½: æŸ¥æ‰¾æŒ‡å®šè·¯å¾‘ä¸‹æœ€å¤§çš„æª”æ¡ˆèˆ‡ç›®éŒ„
# ä½œ    è€…: ç¨‹å¼å¤¥ä¼´
# ç‰ˆ    æœ¬: 1.0
# ä½¿    ç”¨: ./find_top_usage.sh [è·¯å¾‘] [é¡¯ç¤ºæ•¸é‡]
# ==============================================================================

# --- é è¨­è®Šæ•¸ ---

# å¦‚æœä½¿ç”¨è€…æœªæä¾›è·¯å¾‘ï¼Œé è¨­æœå°‹æ ¹ç›®éŒ„ "/"
SEARCH_PATH=${1:-"/"}

# å¦‚æœä½¿ç”¨è€…æœªæä¾›é¡¯ç¤ºæ•¸é‡ï¼Œé è¨­é¡¯ç¤ºå‰ 20 ç­†
NUM_LINES=${2:-20}

# --- å‡½æ•¸å®šç¾© ---

# é¡¯ç¤ºä½¿ç”¨èªªæ˜
usage_help() {
    echo "åŠŸèƒ½: åœ¨æŒ‡å®šè·¯å¾‘ä¸‹ï¼Œæ‰¾å‡ºæœ€ä½”ç”¨ç©ºé–“çš„æª”æ¡ˆèˆ‡ç›®éŒ„ã€‚"
    echo "ç”¨æ³•: $0 [æœå°‹è·¯å¾‘] [é¡¯ç¤ºæ•¸é‡]"
    echo
    echo "åƒæ•¸èªªæ˜:"
    echo "  [æœå°‹è·¯å¾‘]    (å¯é¸) ä½ æƒ³è¦æª¢æŸ¥çš„ç›®éŒ„è·¯å¾‘ã€‚é è¨­ç‚ºæ ¹ç›®éŒ„ '/'ã€‚"
    echo "  [é¡¯ç¤ºæ•¸é‡]    (å¯é¸) ä½ æƒ³è¦é¡¯ç¤ºå‰å¹¾åçš„çµæœã€‚é è¨­ç‚º 20ã€‚"
    echo
    echo "ç¯„ä¾‹:"
    echo "  $0              # æŸ¥è©¢æ•´å€‹ç³»çµ±ä¸­æœ€å¤§çš„ 20 å€‹æª”æ¡ˆ/ç›®éŒ„"
    echo "  $0 /home/user   # æŸ¥è©¢ /home/user ç›®éŒ„ä¸‹æœ€å¤§çš„ 20 å€‹æª”æ¡ˆ/ç›®éŒ„"
    echo "  $0 /var/log 10  # æŸ¥è©¢ /var/log ç›®éŒ„ä¸‹æœ€å¤§çš„ 10 å€‹æª”æ¡ˆ/ç›®éŒ„"
    exit 1
}

# --- ä¸»ç¨‹å¼é‚è¼¯ ---

# æª¢æŸ¥ä½¿ç”¨è€…æ˜¯å¦å°‹æ±‚å¹«åŠ©
if [[ "$1" == "-h" || "$1" == "--help" ]]; then
    usage_help
fi

# æª¢æŸ¥æä¾›çš„è·¯å¾‘æ˜¯å¦å­˜åœ¨ä¸”ç‚ºç›®éŒ„
if [ ! -d "$SEARCH_PATH" ]; then
    echo "éŒ¯èª¤: ç›®éŒ„ '$SEARCH_PATH' ä¸å­˜åœ¨ã€‚" >&2
    usage_help
fi

echo "---"
echo "ğŸ” æ­£åœ¨æŸ¥è©¢ '$SEARCH_PATH' ä¸­æœ€å¤§çš„ $NUM_LINES å€‹æª”æ¡ˆèˆ‡ç›®éŒ„..."
echo "â³ é€™å€‹éç¨‹å¯èƒ½éœ€è¦å¹¾åˆ†é˜ï¼Œç‰¹åˆ¥æ˜¯æŸ¥è©¢æ ¹ç›®éŒ„ '/' æ™‚ï¼Œè«‹è€å¿ƒç­‰å€™ã€‚"
echo "---"

# æ ¸å¿ƒæŒ‡ä»¤
# ä½¿ç”¨ sudo æ˜¯ç‚ºäº†ç¢ºä¿æœ‰æ¬Šé™è®€å–æ‰€æœ‰ç›®éŒ„ï¼Œé¿å…å‡ºç¾å¤§é‡ "Permission denied" éŒ¯èª¤è¨Šæ¯
# å¦‚æœä½ åªæ˜¯æƒ³æŸ¥è©¢è‡ªå·±çš„å®¶ç›®éŒ„ï¼Œå¯ä»¥ä¸åŠ  sudo
sudo du -ah "$SEARCH_PATH" 2>/dev/null | sort -hr | head -n "$NUM_LINES"

echo "---"
echo "âœ… æŸ¥è©¢å®Œæˆã€‚"
